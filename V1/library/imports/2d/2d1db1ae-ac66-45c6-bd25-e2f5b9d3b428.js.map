{"version":3,"sources":["assets\\scripts\\utils\\state.ts"],"names":[],"mappings":";;;;;;AAAA,oBAAoB;AACpB,uDAAuD;AACvD,6BAA6B;AAC7B,MAAM;AACN;;;GAGG;AACH,gDAA+C;AAC/C,6CAAwC;AAExC,IAAM,QAAQ,GAAG,YAAY,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;AAElD,OAAO,CAAC,GAAG,CAAC,qBAAW,CAAC,CAAC;AACzB,IAAM,KAAK,GAAgB;IACvB;;OAEG;IACH,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QACxC,EAAE,EAAE,MAAM;QACV,QAAQ,EAAE,aAAa;QACvB,OAAO,EAAE,CAAC;QACV,IAAI,EAAE,CAAC;QACP,KAAK,EAAE,KAAK;QACZ,SAAS,EAAE,KAAK;QAChB,MAAM,EAAE,CAAC;KACZ;IAED;;OAEG;IACH,EAAE,EAAE;QACA,SAAS,EAAE,KAAK;QAChB,IAAI,YAAC,CAAC,EAAE,CAAC,IAAG,CAAC;QACb,EAAE,YAAC,CAAC,EAAE,CAAC,IAAG,CAAC;QACX,GAAG,YAAC,CAAC,EAAE,CAAC,IAAG,CAAC;QACZ;;WAEG;QACH,MAAM,EAAE,KAAK;KAChB;IAED;;OAEG;IACH,MAAM,EAAE;QACJ;;;;;;;WAOG;QACH,KAAK,EAAE,CAAC;KACX;IAED;;OAEG;IACH,YAAY,EAAE;QACV;;WAEG;QACH,KAAK,EAAE;YACH,KAAK,EAAE,CAAC;SACX;QACD;;WAEG;QACH,YAAY,EAAE;YACV,KAAK,EAAE,CAAC;SACX;KACJ;IAED;;OAEG;IACH,KAAK,EAAE,EAAE;IAET;;OAEG;IACH,QAAQ,EAAE;IACN,UAAU;IACV,gBAAgB;IAChB,YAAY;IACZ,gBAAgB;IAChB,gBAAgB;IAChB,cAAc;IACd,cAAc;IACd,gBAAgB;IAChB,eAAe;IACf,kFAAkF;IAClF,eAAe;IACf,eAAe;KAClB;IAED;;OAEG;IACH,SAAS,EAAE,EAAE,CAAC,GAAG,CAAC,QAAQ,KAAK,EAAE,CAAC,GAAG,CAAC,WAAW;IAEjD;;OAEG;IACH,UAAU,EAAE,EAAE,CAAC,GAAG,CAAC,SAAS;IAE5B;;OAEG;IACH,QAAQ,EAAE,gDAAgD;IAE1D;;OAEG;IACH,MAAM,EAAE,qBAAW;IAEnB;;;;;;OAMG;IACH,IAAI,EAAJ,UAAK,OAAe,EAAE,OAAmB,EAAE,MAAuB,EAAE,IAAS;QAAvD,wBAAA,EAAA,WAAmB;QAAE,uBAAA,EAAA,cAAuB;QAAE,qBAAA,EAAA,QAAQ,CAAC;QACzE,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,MAAM,EAAE,UAAC,IAAI,EAAE,MAAM;gBACrD,IAAI,MAAM,EAAE;oBACR,IAAM,KAAK,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;oBACrC,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;oBACvC,IAAM,WAAW,GAAG,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;oBAC/C,WAAW,CAAC,UAAU,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;oBACvD,OAAO,CAAC,WAAW,CAAC,CAAC;iBACxB;;oBAAM,MAAM,CAAC,IAAI,CAAC,CAAC;YACxB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;CACJ,CAAA;AAED,kBAAe,KAAK,CAAC;AAGrB;;GAEG;AACH,kDAAwC;AACxC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,OAAO,EAAE,CAAC;AAC7C,SAAS,OAAO;IACZ,IAAI,gBAAgB,GAAG,EAAE,CAAC;IAC1B,IAAI,iBAAiB,GAAG,EAAE,CAAC;IAE3B,OAAO;IACD,IAAA,KAAW,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,IAAI,CAAC,EAA5D,CAAC,OAAA,EAAE,CAAC,OAAwD,CAAC;IACrE,IAAI,CAAC,IAAI,CAAC,EAAE;QACR,iBAAiB,GAAG,qBAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACzC,gBAAgB,GAAG,qBAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;KAC3C;IAED,IAAI,CAAC,gBAAgB,IAAI,CAAC,iBAAiB;QAAE,OAAO;IAEpD,oBAAK,CAAC,GAAG,CAAC,OAAO,EAAE;QACX,IAAI,EAAE;YACF,OAAO,EAAE,gBAAgB;YACzB,QAAQ,EAAE,iBAAiB;SAC9B;KACJ,CAAC;SACD,IAAI,CAAC,UAAC,GAAG;QACN,IAAI,GAAG,CAAC,KAAK,EAAE;YACX,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;YACtD,KAAK,CAAC,QAAQ,GAAG,GAAG,CAAC;YACrB,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;SAC1C;IACL,CAAC,CAAC,CACL;AACL,CAAC","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n// cc.assetManager.loadBundle('lib', (err, bundle) => {\r\n//     // bundle.load('lib');\r\n// });\r\n/**\r\n * 缓存数据\r\n * 负责数据缓存npm install --save socket.io-wxapp-client\r\n */\r\nimport { confusion } from '../utils/confusion';\r\nimport gameSetting from './gameSetting';\r\nimport { Utils } from '../interface/index';\r\nconst userInfo = localStorage.getItem('userInfo');\r\n\r\nconsole.log(gameSetting);\r\nconst State: Utils.State = {\r\n    /**\r\n     * 用户数据\r\n     */\r\n    userInfo: userInfo ? JSON.parse(userInfo) : {\r\n        id: '0000',\r\n        nickname: '* * * * * *',\r\n        diamond: 0,\r\n        gold: 0,\r\n        token: false,\r\n        avatarUrl: false,\r\n        signal: 0,\r\n    },\r\n\r\n    /**\r\n     * WebSocket IO\r\n     */\r\n    io: {\r\n        connected: false,\r\n        emit(k, c) {},\r\n        on(k, c) {},\r\n        off(k, c) {},\r\n        /**\r\n         * 是否被占线\r\n         */\r\n        online: false,\r\n    },\r\n\r\n    /**\r\n     * 服务器数据\r\n     */\r\n    server: {\r\n        /**\r\n         * 状态:\r\n         *  - -1: 关闭中\r\n         *  -  0: 正常\r\n         *  -  1: 维护中\r\n         *  -  2: 拥挤\r\n         *   \r\n         */\r\n        state: 0,\r\n    },\r\n\r\n    /**\r\n     * 服务器配置\r\n     */\r\n    serverConfig: {\r\n        /**\r\n         * 服务器状态\r\n         */\r\n        state: {\r\n            value: 0,\r\n        },\r\n        /**\r\n         * 启动内容\r\n         */\r\n        startMessage: {\r\n            value: 0,\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 游戏设置\r\n     */\r\n    games: [],\r\n\r\n    /**\r\n     * 游戏数据\r\n     */\r\n    gameData: {\r\n        // id: -1,\r\n        // gameName: '',\r\n        // name: '',\r\n        // peopleMax: 0,\r\n        // frequency: 0,\r\n        // payType: 0,\r\n        // pwdType: 0,\r\n        // roomCode: '',\r\n        // roomPwd: -1,\r\n        // gameData: { createTime: 1582084691210, blackSetp: 0, whiteSetp: 0, target: 0 },\r\n        // players: [],\r\n        // isStart: !0,\r\n    },\r\n\r\n    /**\r\n     * 是否为微信游戏客户端\r\n     */\r\n    IS_WECHAT: cc.sys.platform === cc.sys.WECHAT_GAME,\r\n\r\n    /**\r\n     * 是否为浏览器\r\n     */\r\n    IS_BROWSER: cc.sys.isBrowser,\r\n\r\n    /**\r\n     * OSS对象加速\r\n     */\r\n    OSS_BASE: 'https://perfergame.oss-cn-beijing.aliyuncs.com',\r\n\r\n    /**\r\n     * 系统设置\r\n     */\r\n    system: gameSetting,\r\n\r\n    /**\r\n     * 弹出提示\r\n     * @param content 内容\r\n     * @param timeout 收起时间\r\n     * @param effect  是否播放音效\r\n     * @param icon    图标（-1：不显示，1：成功，2：失败，3：警告）\r\n     */\r\n    tips(content: string, timeout: number = 2, effect: boolean = false, icon = -1) {\r\n        return new Promise((resolve, reject) => {\r\n            cc.loader.loadRes('prefab/tips', cc.Prefab, (_err, prefab) => {\r\n                if (prefab) {\r\n                    const popup = cc.instantiate(prefab);\r\n                    cc.director.getScene().addChild(popup);\r\n                    const scriptPopup = popup.getComponent('Tips');\r\n                    scriptPopup.setContent(content, timeout, effect, icon);\r\n                    resolve(scriptPopup);\r\n                } else reject(_err);\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nexport default State;\r\n\r\n\r\n/**\r\n * 全局重登机制 [Bate]\r\n */\r\nimport axios from '../utils/axiosUtils';\r\nlocalStorage.getItem('account') && onLogin();\r\nfunction onLogin() {\r\n    let accountInputText = '';\r\n    let passwordInputText = '';\r\n    \r\n    // 重新登录\r\n    const { a, p } = JSON.parse(localStorage.getItem('account') || '{}');\r\n    if (a && p) {\r\n        passwordInputText = confusion.decrypt(p);\r\n        accountInputText = confusion.decrypt(a);\r\n    }\r\n\r\n    if (!accountInputText || !passwordInputText) return;\r\n\r\n    axios.api('login', {\r\n            data: {\r\n                account: accountInputText,\r\n                password: passwordInputText,\r\n            }\r\n        })\r\n        .then((res) => {\r\n            if (res.token) {\r\n                localStorage.setItem('userInfo', JSON.stringify(res));\r\n                State.userInfo = res;\r\n                cc.game.emit('tokenUpdate', res.token);\r\n            }\r\n        })\r\n    ;\r\n}\r\n"]}