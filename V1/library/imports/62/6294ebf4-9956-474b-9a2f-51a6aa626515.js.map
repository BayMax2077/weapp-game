{"version":3,"sources":["assets\\scripts\\Home\\script\\HomeGames.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\nimport axios from '../../utils/axiosUtils';\r\nimport { luanchOptions, onShow, offShow } from '../../lib/tool';\r\nimport State from '../../utils/state';\r\n\r\ncc.view.setResizeCallback((e) => {\r\n  const { width, height } = cc.winSize;\r\n  console.log()\r\n  if (width < height) {\r\n    console.log(cc.macro.ORIENTATION_LANDSCAPE)\r\n    cc.view.setOrientation(cc.macro.ORIENTATION_PORTRAIT)\r\n  }\r\n})\r\n\r\n@ccclass\r\nexport default class HomeGames extends cc.Component {\r\n    // 创建房间资源\r\n    @property(cc.Prefab) createRoomPrefab: cc.Prefab = null;\r\n    // 滚动消息条\r\n    @property(cc.Node) MessageBox: cc.Node = null;\r\n    // 滚动消息内容\r\n    @property(cc.Label) MessageContent: cc.Label = null;\r\n    // 游戏列表\r\n    @property(cc.PageView) GameList: cc.PageView = null;\r\n    // 滚动消息列表\r\n    messageList: Array<{ id: number; content: string; }> = [];\r\n    // 当前消息ID\r\n    messageId: number = 0;\r\n\r\n\r\n    start() {\r\n        axios.api('get_home_message').then(messageList => this.messageList = messageList);\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            onShow(this.wxShow, this);\r\n        }\r\n        // 加入房间检测\r\n        this.joinUserRoom();\r\n        \r\n    }\r\n\r\n\r\n    /**\r\n     * 销毁时\r\n     */\r\n    onDestroy() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            offShow(this.wxShow, this);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 显示为前台时\r\n     * @param option 参数\r\n     */\r\n    wxShow(option) {\r\n        luanchOptions.query = option.query;\r\n        this.joinUserRoom();\r\n    }\r\n\r\n\r\n    /**\r\n     * 跳转到指定页面\r\n     * @param pageIndex 页面下标\r\n     */\r\n    jumpPage(_e, pageIndex: number) {\r\n        this.GameList.scrollToPage(Number(pageIndex), .5);\r\n        // this.GameList.setCurrentPageIndex(pageIndex);\r\n    }\r\n\r\n\r\n    /**\r\n     * 加入用户房间检测\r\n     */\r\n    joinUserRoom() {\r\n        if (luanchOptions.query.fn === 'joinRoom' && luanchOptions.query.roomCode) {\r\n            this.joinRoomEvent(luanchOptions.query.roomCode);\r\n            luanchOptions.query = {};\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 加入房间\r\n     */\r\n    joinRoom() {\r\n        const that = this;\r\n        cc.loader.loadRes('prefab/keyboard', cc.Prefab, (err, prefab) => {\r\n            if (prefab) {\r\n                const joinRoomPopup = cc.instantiate(prefab);\r\n                cc.director.getScene().addChild(joinRoomPopup);\r\n                joinRoomPopup && (joinRoomPopup.getComponent('keyboard').parentClass = {\r\n                    emit: that.joinRoomEvent,\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * 加入房间事件\r\n     * @param roomCode 房间号\r\n     */\r\n    joinRoomEvent(roomCode: number) {\r\n        axios.api('room_join', {\r\n            data: {\r\n                roomCode,\r\n            },\r\n        }).then(({ status, msg }) => {\r\n            if (status && msg && msg.scene) {\r\n                cc.director.loadScene(msg.scene);\r\n            } else {\r\n                cc.loader.loadRes('prefab/popup', cc.Prefab, (_err, prefab) => {\r\n                    if (prefab) {\r\n                        const popup = cc.instantiate(prefab);\r\n                        cc.director.getScene().addChild(popup);\r\n                        const scriptPopup = popup.getComponent('popup');\r\n                        scriptPopup.init('加入房间失败!\\n' + msg);\r\n                        scriptPopup.setEvent('close', () => {});\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * 随机加入房间\r\n     */\r\n    roomRandom() {\r\n        axios.api('room_random').then(({ status, msg }) => {\r\n            if (status && msg && msg.scene) {\r\n                cc.director.loadScene(msg.scene);\r\n            } else {\r\n                cc.loader.loadRes('prefab/popup', cc.Prefab, (_err, prefab) => {\r\n                    if (prefab) {\r\n                      const popup = cc.instantiate(prefab);\r\n                      cc.director.getScene().addChild(popup);\r\n                      const scriptPopup = popup.getComponent('popup');\r\n                      if (msg === '房间不存在!') {\r\n                        msg = '没有可用的房间!';\r\n                      }\r\n                      scriptPopup.init('加入房间失败!\\n' + msg);\r\n                      scriptPopup.setEvent('close', () => {});\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * 创建房间点击事件\r\n     */\r\n    showCreateRoomPopup(_e, gameName?: string) {\r\n        const createRoomPrefab = cc.instantiate(this.createRoomPrefab);\r\n        cc.director.getScene().addChild(createRoomPrefab);\r\n        const prefabScript = createRoomPrefab.getComponent('Room');\r\n        if (!gameName) {\r\n            return prefabScript.typeRoomModel();\r\n        }\r\n        if (typeof gameName === 'string') {\r\n            const createRoom = prefabScript.createNode;\r\n            const Room = createRoom.getComponent('CreateRoom');\r\n            prefabScript.createRoomModel();\r\n            Room.renderCallBack = () => {\r\n                console.log(Room.listItems[gameName], gameName);\r\n                const current = Room.listItems[gameName];\r\n                if (current) {\r\n                    current.onClick();\r\n                    const popup = Room.onCreateRoom(() => popup.success());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    update() {\r\n        // 消息滚动逻辑\r\n        const { messageId, messageList, MessageContent } = this;\r\n        if (MessageContent && messageList[messageId]) {\r\n            const { node } = MessageContent;\r\n            const MessageBoxWidth = this.MessageBox.width;\r\n            //  如果完全超出最右方\r\n            if (node.x < -node.width) {\r\n                MessageContent.string = messageList[messageId].content;\r\n                node.x = MessageBoxWidth;\r\n                this.messageId++;\r\n            } else {\r\n                node.x -= .5;\r\n            }\r\n        } else {\r\n            this.messageId = 0;\r\n        }\r\n    }\r\n}\r\n"]}