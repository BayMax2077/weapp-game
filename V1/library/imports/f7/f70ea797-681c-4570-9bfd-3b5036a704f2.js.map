{"version":3,"sources":["assets\\scripts\\Home\\script\\CreateRoom.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\nimport axios from '../../utils/axiosUtils';\r\nimport State from '../../utils/state';\r\n\r\n/**\r\n * 游戏房间配置\r\n */\r\nconst gameOption = {\r\n    gobang: {\r\n        name: '五子棋',\r\n        room: [\r\n            [ '人数', '2人' ],\r\n            [ '局数', '1局' ],\r\n            [ '支付', '房主支付' ],\r\n            [ '密码', '公开' ],\r\n        ],\r\n        keyword: [ 'people' ,'frequency' ,'payType' ,'pwdType' ],\r\n        scene: 'gamesGoBang',\r\n    },\r\n    fourCards: {\r\n        name: '四副牌',\r\n        room: [\r\n            [ '人数', '4人', '2人(测试用)' ],\r\n            [ '局数', '1局' ],\r\n            [ '支付', '房主支付' ],\r\n            [ '密码', '公开' ],\r\n        ],\r\n        keyword: [ 'people' ,'frequency' ,'payType' ,'pwdType' ],\r\n        scene: 'gameFourCards',\r\n    },\r\n    flightChess: {\r\n        name: '飞行棋',\r\n        room: [\r\n            [ '人数', '2人', '3人', '4人' ],\r\n            [ '局数', '1局' ],\r\n            [ '起飞', '6点', '3点', '3、6点' ],\r\n            [ '密码', '公开' ],\r\n        ],\r\n        keyword: [ 'people' ,'frequency' ,'takeOff' ,'pwdType' ],\r\n        scene: 'gameFlightChess',\r\n    },\r\n}\r\n/**\r\n * 选项实例\r\n */\r\nlet radioOption: any = [];\r\n\r\n@ccclass\r\nexport default class CreateRoom extends cc.Component {\r\n    // 主盒子\r\n    @property(cc.Node) mainBox: cc.Node = null;\r\n    // 左侧盒子\r\n    @property(cc.Node) leftTopBox: cc.Node = null;\r\n    // 大内容内容区域\r\n    @property(cc.Node) ContentBoxView: cc.Node = null;\r\n    // 选项组资源\r\n    @property(cc.Prefab) radioGroup: cc.Prefab = null;\r\n    // 列表资源\r\n    @property(cc.Prefab) listItem: cc.Prefab = null;\r\n    // 项目资源\r\n    @property(cc.SpriteFrame) itemSpriteFrame: cc.SpriteFrame[] = [];\r\n    // 弹窗\r\n    @property(cc.Prefab) popupPrefab: cc.Prefab = null;\r\n    // 当前选中的游戏名\r\n    _ROOM_NAME_: string = '';\r\n    // 当前选中的GAME\r\n    _GANE_: any = {};\r\n    // 项目节点列表\r\n    listItems = {};\r\n    // 渲染完成后的回调\r\n    renderCallBack: any;\r\n\r\n    start() {\r\n        let prveClick = null;\r\n        \r\n        // 创建按钮实例化\r\n        Object.keys(gameOption).forEach((key, index) => {\r\n            const item = gameOption[key];\r\n            const itemInstantiate = cc.instantiate(this.listItem);\r\n            const ListItem = itemInstantiate.getComponent('ListItem');\r\n            ListItem.init({\r\n                id: index,\r\n                scale: .5,\r\n                title: item.name,\r\n                sprite: this.itemSpriteFrame[index],\r\n            });\r\n            itemInstantiate.x -= itemInstantiate.x;\r\n            itemInstantiate.y -= (index * 50) + itemInstantiate.height;\r\n            this.leftTopBox.addChild(itemInstantiate);\r\n\r\n            ListItem.clickEvent = () => {\r\n                prveClick && prveClick.blur();\r\n                this.loadPrefab(key);\r\n                prveClick = ListItem;\r\n                this._ROOM_NAME_ = key;\r\n            }\r\n\r\n            if (index === 0) {\r\n                ListItem.onClick();\r\n            }\r\n\r\n            this.listItems[key] = ListItem;\r\n        });\r\n        \r\n        // 渲染完成 回调\r\n        this.renderCallBack && this.renderCallBack();\r\n    }\r\n\r\n\r\n    /**\r\n     * 加载创建房间的设置资源\r\n     * @param prefabName - 游戏名\r\n     */\r\n    loadPrefab(prefabName: string) {\r\n        this.ContentBoxView.destroyAllChildren();\r\n        const gameOpt = gameOption[prefabName];\r\n        if (gameOpt) {\r\n            radioOption = [];\r\n            this.ContentBoxView.height = 70;\r\n            gameOpt.room.forEach((opt: string[], index) => {\r\n                opt = Object.assign([], opt);\r\n                const optGroup = cc.instantiate(this.radioGroup);\r\n                const radioScript = optGroup.getComponent('Radio');\r\n                radioScript.init(opt.shift(), opt);\r\n                this.ContentBoxView.addChild(optGroup);\r\n                optGroup.y -= index * 60 - 150;\r\n                radioOption.push({\r\n                    instantiate: optGroup,\r\n                    script: radioScript,\r\n                    config: opt[0],\r\n                    keyword: gameOpt.keyword[index],\r\n                });\r\n                this.ContentBoxView.height += 70;\r\n            });\r\n            this._GANE_ = gameOpt;\r\n            cc.director.preloadScene(gameOpt.scene);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 界面隐藏\r\n     * @param Action - 是否显示动画\r\n     */\r\n    popupHide() {\r\n        this.node.destroy();\r\n    }\r\n\r\n\r\n    /**\r\n     * 创建房间按钮 按下事件\r\n     */\r\n    async onCreateRoom() {\r\n        const query = {};\r\n        radioOption.forEach(item => {\r\n            query[item.keyword] = item.script.value - 1;\r\n        });\r\n\r\n        return new Promise((resolve, reject) => {\r\n            axios\r\n                .api('create_room', {\r\n                    params: {\r\n                        gameName: this._ROOM_NAME_, \r\n                    },\r\n                    data: query,\r\n                })\r\n                .then((res) => {\r\n                    const popup = cc.instantiate(this.popupPrefab);\r\n                    cc.director.getScene().addChild(popup);\r\n                    const scriptPopup = popup.getComponent('popup');\r\n                    scriptPopup.init('创建中...');\r\n                    if (res.status) {\r\n                        axios.api('room_info').then(res => {\r\n                            scriptPopup.message(`创建成功!\\n房间号: ${res.roomCode}`);\r\n                            scriptPopup.setEvent('success', () => {\r\n                                popup.destroy();\r\n                                this.node.destroy();\r\n                                cc.director.loadScene(this._GANE_.scene);\r\n                            });\r\n                            resolve(scriptPopup);\r\n                        });\r\n                    } else {\r\n                        scriptPopup.message(`创建失败!\\n${res.msg}`);\r\n                        // scriptPopup.setEvent('reset', () => {\r\n                        //     this.createRoomClick();\r\n                        // });\r\n                        scriptPopup.setEvent('close', () => {});\r\n                        reject(scriptPopup);\r\n                    }\r\n                })\r\n                .catch(() => State.tips('界面打开失败!'))\r\n            ;\r\n        });\r\n    }\r\n}\r\n"]}