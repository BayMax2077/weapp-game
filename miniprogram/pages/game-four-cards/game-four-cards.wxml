<!--pages/game-four-cards/game-four-cards.wxml-->
<view class="game-container">
  <!-- æ¸¸æˆå¤´éƒ¨ä¿¡æ¯ -->
  <view class="game-header">
    <view class="game-info">
      <view class="game-title">å››å¼ ç‰Œ</view>
      <view class="room-info">
        <view class="room-code">æˆ¿é—´å·: {{roomCode}}</view>
        <view class="current-player">å½“å‰ç©å®¶: {{currentPlayerName}}</view>
      </view>
    </view>
    <view class="game-controls">
      <button class="btn btn-ghost btn-sm" bindtap="pauseGame">æš‚åœ</button>
      <button class="btn btn-ghost btn-sm" bindtap="exitGame">é€€å‡º</button>
    </view>
  </view>

  <!-- ç©å®¶ä¿¡æ¯ -->
  <view class="players-info">
    <view class="player-card {{index === currentPlayer ? 'active' : ''}}" 
          wx:for="{{players}}" 
          wx:key="id">
      <view class="player-avatar">
        <image class="avatar" src="{{item.avatarUrl || '/assets/images/default-avatar.png'}}" mode="aspectFill"></image>
      </view>
      <view class="player-info">
        <view class="player-name">{{item.nickname}}</view>
        <view class="player-stats">
          <view class="stat">åˆ†æ•°: {{item.score}}</view>
          <view class="stat">æŠ“åˆ†: {{item.noteScore}}</view>
          <view class="stat">ç‰Œæ•°: {{item.cardCount}}</view>
        </view>
      </view>
      <view class="player-status">
        <view class="status-text">{{item.status}}</view>
        <view class="timer" wx:if="{{item.timer > 0}}">{{item.timer}}s</view>
      </view>
    </view>
  </view>

  <!-- æ¡Œé¢åŒºåŸŸ -->
  <view class="desktop-area">
    <view class="desktop-score">
      <view class="score-label">æ¡Œé¢åˆ†æ•°</view>
      <view class="score-value">{{desktopScore}}</view>
    </view>
    <view class="desktop-cards">
      <view class="card {{card.faceUp ? 'face-up' : 'face-down'}}" 
            wx:for="{{desktopCards}}" 
            wx:key="id">
        <view class="card-content" wx:if="{{card.faceUp}}">
          <view class="card-suit">{{card.suit}}</view>
          <view class="card-rank">{{card.rank}}</view>
        </view>
        <view class="card-back" wx:else>
          <view class="card-pattern">ğŸ‚ </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆ‘çš„æ‰‹ç‰Œ -->
  <view class="my-cards" wx:if="{{myCards.length > 0}}">
    <view class="cards-title">æˆ‘çš„æ‰‹ç‰Œ</view>
    <view class="cards-container">
      <view class="card {{card.selected ? 'selected' : ''}} {{card.disabled ? 'disabled' : ''}}" 
            wx:for="{{myCards}}" 
            wx:key="id"
            bindtap="selectCard"
            data-card-id="{{card.id}}">
        <view class="card-content">
          <view class="card-suit">{{card.suit}}</view>
          <view class="card-rank">{{card.rank}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="game-actions" wx:if="{{isMyTurn}}">
    <button class="btn btn-primary" 
            bindtap="playCards" 
            disabled="{{selectedCards.length === 0}}">
      å‡ºç‰Œ ({{selectedCards.length}})
    </button>
    <button class="btn btn-outline" bindtap="skipTurn">ä¸å‡º</button>
  </view>

  <!-- æ¸¸æˆæç¤º -->
  <view class="game-hints" wx:if="{{showHint}}">
    <view class="hint-text">{{hintText}}</view>
  </view>

  <!-- æ¸¸æˆç»“æœå¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showResult}}" bindtap="hideResult">
    <view class="modal-content result-modal" catchtap="true">
      <view class="result-header">
        <view class="result-title">{{gameResult.title}}</view>
        <view class="result-subtitle">{{gameResult.subtitle}}</view>
      </view>
      <view class="result-content">
        <view class="players-ranking">
          <view class="ranking-item {{index === 0 ? 'winner' : ''}}" 
                wx:for="{{gameResult.players}}" 
                wx:key="id">
            <view class="ranking-number">{{index + 1}}</view>
            <image class="player-avatar" src="{{item.avatarUrl}}" mode="aspectFill"></image>
            <view class="player-info">
              <view class="player-name">{{item.nickname}}</view>
              <view class="player-score">åˆ†æ•°: {{item.score}}</view>
            </view>
            <view class="player-note-score">æŠ“åˆ†: {{item.noteScore}}</view>
          </view>
        </view>
        <view class="game-stats">
          <view class="stat-item">
            <view class="stat-label">æ¸¸æˆæ—¶é•¿</view>
            <view class="stat-value">{{gameResult.duration}}</view>
          </view>
          <view class="stat-item">
            <view class="stat-label">æ€»å›åˆæ•°</view>
            <view class="stat-value">{{gameResult.totalTurns}}</view>
          </view>
        </view>
      </view>
      <view class="result-actions">
        <button class="btn btn-outline" bindtap="playAgain">å†æ¥ä¸€å±€</button>
        <button class="btn btn-primary" bindtap="backToHome">è¿”å›é¦–é¡µ</button>
      </view>
    </view>
  </view>

  <!-- æš‚åœå¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showPause}}" bindtap="hidePause">
    <view class="modal-content pause-modal" catchtap="true">
      <view class="pause-header">
        <view class="pause-title">æ¸¸æˆæš‚åœ</view>
      </view>
      <view class="pause-actions">
        <button class="btn btn-primary btn-full" bindtap="resumeGame">ç»§ç»­æ¸¸æˆ</button>
        <button class="btn btn-outline btn-full" bindtap="exitGame">é€€å‡ºæ¸¸æˆ</button>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading"></view>
    <view class="loading-text">æ¸¸æˆåŠ è½½ä¸­...</view>
  </view>
</view>
