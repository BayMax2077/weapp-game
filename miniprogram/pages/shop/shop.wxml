<!--pages/shop/shop.wxml-->
<view class="container">
  <!-- ç”¨æˆ·èµ„äº§å¡ç‰‡ -->
  <view class="assets-card" wx:if="{{userAssets}}">
    <view class="assets-header">
      <view class="assets-title">æˆ‘çš„èµ„äº§</view>
      <button class="btn btn-ghost btn-sm" bindtap="refreshUserAssets">
        <text class="btn-text">åˆ·æ–°</text>
      </button>
    </view>
    <view class="assets-content">
      <view class="asset-item">
        <view class="asset-icon">ğŸ’°</view>
        <view class="asset-info">
          <view class="asset-name">é‡‘å¸</view>
          <view class="asset-value">{{userAssets.coins || 0}}</view>
        </view>
      </view>
      <view class="asset-item">
        <view class="asset-icon">ğŸ’</view>
        <view class="asset-info">
          <view class="asset-name">é’»çŸ³</view>
          <view class="asset-value">{{userAssets.diamonds || 0}}</view>
        </view>
      </view>
      <view class="asset-item">
        <view class="asset-icon">ğŸ</view>
        <view class="asset-info">
          <view class="asset-name">é“å…·</view>
          <view class="asset-value">{{userAssets.items || 0}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»å¯¼èˆª -->
  <view class="category-nav">
    <scroll-view class="category-scroll" scroll-x="true" show-scrollbar="false">
      <view class="category-list">
        <view 
          class="category-item {{selectedCategory === item.id ? 'active' : ''}}" 
          wx:for="{{categories}}" 
          wx:key="id"
          bindtap="onCategorySelect"
          data-category-id="{{item.id}}"
        >
          <view class="category-icon">{{item.icon}}</view>
          <view class="category-name">{{item.name}}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="products-section">
    <view class="section-header">
      <view class="section-title">{{currentCategory.name || 'å…¨éƒ¨å•†å“'}}</view>
      <view class="section-count">{{filteredProducts.length}}ä¸ªå•†å“</view>
    </view>
    
    <view class="products-grid" wx:if="{{filteredProducts.length > 0}}">
      <view class="product-card" wx:for="{{filteredProducts}}" wx:key="id" bindtap="onProductBuy" data-product-id="{{item.id}}">
        <view class="product-image">
          <image class="product-img" src="{{item.image || '/assets/images/product-default.png'}}" mode="aspectFill"></image>
          <view class="product-badge" wx:if="{{item.isHot}}">çƒ­é—¨</view>
          <view class="product-badge new" wx:if="{{item.isNew}}">æ–°å“</view>
        </view>
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-desc">{{item.description}}</view>
          <view class="product-price">
            <view class="price-main">{{item.price}}</view>
            <view class="price-unit">{{item.currencyName}}</view>
          </view>
          <view class="product-actions">
            <button class="btn btn-primary btn-sm btn-full" catchtap="buyProduct" data-product-id="{{item.id}}">
              ç«‹å³è´­ä¹°
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <image class="empty-icon" src="/assets/images/empty-products.png" mode="aspectFit"></image>
      <view class="empty-text">æš‚æ— å•†å“</view>
      <view class="empty-desc">è¯·é€‰æ‹©å…¶ä»–åˆ†ç±»</view>
    </view>
  </view>

  <!-- å•†å“è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showProductDetail}}" bindtap="hideProductDetail">
    <view class="modal-content product-detail-modal" catchtap="true">
      <view class="modal-header">
        <view class="modal-title">å•†å“è¯¦æƒ…</view>
        <button class="modal-close" bindtap="hideProductDetail">Ã—</button>
      </view>
      <view class="modal-body" wx:if="{{selectedProduct}}">
        <view class="product-detail-image">
          <image class="detail-img" src="{{selectedProduct.image || '/assets/images/product-default.png'}}" mode="aspectFill"></image>
        </view>
        <view class="product-detail-info">
          <view class="detail-name">{{selectedProduct.name}}</view>
          <view class="detail-desc">{{selectedProduct.description}}</view>
          <view class="detail-price">
            <view class="price-main">{{selectedProduct.price}}</view>
            <view class="price-unit">{{selectedProduct.currencyName}}</view>
          </view>
          <view class="detail-features" wx:if="{{selectedProduct.features}}">
            <view class="feature-title">å•†å“ç‰¹è‰²</view>
            <view class="feature-list">
              <view class="feature-item" wx:for="{{selectedProduct.features}}" wx:key="*this">â€¢ {{item}}</view>
            </view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn btn-outline" bindtap="hideProductDetail">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="buyProduct" data-product-id="{{selectedProduct.id}}">ç«‹å³è´­ä¹°</button>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>