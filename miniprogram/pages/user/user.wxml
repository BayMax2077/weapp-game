<!--pages/user/user.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
  <view class="user-header" wx:if="{{userInfo}}">
    <view class="user-avatar-section">
      <image class="avatar avatar-xl" src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}" mode="aspectFill"></image>
      <view class="user-badge" wx:if="{{userInfo.level}}">Lv.{{userInfo.level}}</view>
    </view>
    <view class="user-info">
      <view class="user-name">{{userInfo.nickname || 'æ¸¸å®¢ç”¨æˆ·'}}</view>
      <view class="user-id">ID: {{userInfo.id || '000000'}}</view>
      <view class="user-stats">
        <view class="stat-item">
          <view class="stat-value">{{userInfo.gamesPlayed || 0}}</view>
          <view class="stat-label">æ¸¸æˆåœºæ¬¡</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{userInfo.winRate || 0}}%</view>
          <view class="stat-label">èƒœç‡</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{userInfo.rank || 'æœªå®šçº§'}}</view>
          <view class="stat-label">æ®µä½</view>
        </view>
      </view>
    </view>
  </view>

  <!-- èµ„äº§å¡ç‰‡ -->
  <view class="assets-card" wx:if="{{userAssets}}">
    <view class="assets-header">
      <view class="assets-title">æˆ‘çš„èµ„äº§</view>
      <button class="btn btn-ghost btn-sm" bindtap="onAssetsTap">
        <text class="btn-text">è¯¦æƒ…</text>
      </button>
    </view>
    <view class="assets-grid">
      <view class="asset-item">
        <view class="asset-icon">ğŸ’°</view>
        <view class="asset-info">
          <view class="asset-name">é‡‘å¸</view>
          <view class="asset-value">{{userAssets.coins || 0}}</view>
        </view>
      </view>
      <view class="asset-item">
        <view class="asset-icon">ğŸ’</view>
        <view class="asset-info">
          <view class="asset-name">é’»çŸ³</view>
          <view class="asset-value">{{userAssets.diamonds || 0}}</view>
        </view>
      </view>
      <view class="asset-item">
        <view class="asset-icon">ğŸ</view>
        <view class="asset-info">
          <view class="asset-name">é“å…·</view>
          <view class="asset-value">{{userAssets.items || 0}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆè®°å½• -->
  <view class="game-records-card">
    <view class="card-header">
      <view class="card-title">æœ€è¿‘æ¸¸æˆ</view>
      <button class="btn btn-ghost btn-sm" bindtap="onGameRecordTap">
        <text class="btn-text">æŸ¥çœ‹å…¨éƒ¨</text>
      </button>
    </view>
    <view class="records-list" wx:if="{{gameRecords.length > 0}}">
      <view class="record-item" wx:for="{{gameRecords}}" wx:key="id">
        <view class="record-game">
          <image class="record-icon" src="{{item.gameIcon || '/assets/images/game-default.png'}}" mode="aspectFill"></image>
          <view class="record-info">
            <view class="record-name">{{item.gameName}}</view>
            <view class="record-time">{{item.playTime}}</view>
          </view>
        </view>
        <view class="record-result" data-result="{{item.result}}">
          {{item.result === 'win' ? 'èƒœåˆ©' : item.result === 'lose' ? 'å¤±è´¥' : 'å¹³å±€'}}
        </view>
      </view>
    </view>
    <view class="empty-records" wx:else>
      <view class="empty-text">æš‚æ— æ¸¸æˆè®°å½•</view>
      <view class="empty-desc">å¼€å§‹ä½ çš„ç¬¬ä¸€åœºæ¸¸æˆå§</view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-group">
      <view class="menu-item" bindtap="onSettingsTap">
        <view class="menu-icon">âš™ï¸</view>
        <view class="menu-content">
          <view class="menu-title">è®¾ç½®</view>
          <view class="menu-desc">ä¸ªæ€§åŒ–è®¾ç½®</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="onFeedbackTap">
        <view class="menu-icon">ğŸ’¬</view>
        <view class="menu-content">
          <view class="menu-title">æ„è§åé¦ˆ</view>
          <view class="menu-desc">å¸®åŠ©æˆ‘ä»¬æ”¹è¿›</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="onAboutTap">
        <view class="menu-icon">â„¹ï¸</view>
        <view class="menu-content">
          <view class="menu-title">å…³äºæˆ‘ä»¬</view>
          <view class="menu-desc">ç‰ˆæœ¬ä¿¡æ¯</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
    </view>

    <view class="menu-group">
      <view class="menu-item" bindtap="onLogoutTap">
        <view class="menu-icon">ğŸšª</view>
        <view class="menu-content">
          <view class="menu-title">é€€å‡ºç™»å½•</view>
          <view class="menu-desc">å®‰å…¨é€€å‡º</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showSettings}}" bindtap="hideSettings">
    <view class="modal-content settings-modal" catchtap="true">
      <view class="modal-header">
        <view class="modal-title">è®¾ç½®</view>
        <button class="modal-close" bindtap="hideSettings">Ã—</button>
      </view>
      <view class="modal-body">
        <view class="setting-item">
          <view class="setting-label">éŸ³æ•ˆ</view>
          <switch class="setting-switch" checked="{{settings.sound}}" bindchange="onSoundChange"></switch>
        </view>
        <view class="setting-item">
          <view class="setting-label">éŸ³ä¹</view>
          <switch class="setting-switch" checked="{{settings.music}}" bindchange="onMusicChange"></switch>
        </view>
        <view class="setting-item">
          <view class="setting-label">éœ‡åŠ¨</view>
          <switch class="setting-switch" checked="{{settings.vibration}}" bindchange="onVibrationChange"></switch>
        </view>
        <view class="setting-item">
          <view class="setting-label">é€šçŸ¥</view>
          <switch class="setting-switch" checked="{{settings.notification}}" bindchange="onNotificationChange"></switch>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>