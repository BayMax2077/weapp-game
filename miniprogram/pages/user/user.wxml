<!--pages/user/user.wxml-->
<view class="container">
  <!-- 用户信息头部 -->
  <view class="user-header" wx:if="{{userInfo}}">
    <view class="user-avatar-section">
      <image class="avatar avatar-xl" src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}" mode="aspectFill"></image>
      <view class="user-badge" wx:if="{{userInfo.level}}">Lv.{{userInfo.level}}</view>
    </view>
    <view class="user-info">
      <view class="user-name">{{userInfo.nickname || '游客用户'}}</view>
      <view class="user-id">ID: {{userInfo.id || '000000'}}</view>
      <view class="user-stats">
        <view class="stat-item">
          <view class="stat-value">{{userInfo.gamesPlayed || 0}}</view>
          <view class="stat-label">游戏场次</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{userInfo.winRate || 0}}%</view>
          <view class="stat-label">胜率</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{userInfo.rank || '未定级'}}</view>
          <view class="stat-label">段位</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 资产卡片 -->
  <view class="assets-card" wx:if="{{userAssets}}">
    <view class="assets-header">
      <view class="assets-title">我的资产</view>
      <button class="btn btn-ghost btn-sm" bindtap="onAssetsTap">
        <text class="btn-text">详情</text>
      </button>
    </view>
    <view class="assets-grid">
      <view class="asset-item">
        <view class="asset-icon">💰</view>
        <view class="asset-info">
          <view class="asset-name">金币</view>
          <view class="asset-value">{{userAssets.coins || 0}}</view>
        </view>
      </view>
      <view class="asset-item">
        <view class="asset-icon">💎</view>
        <view class="asset-info">
          <view class="asset-name">钻石</view>
          <view class="asset-value">{{userAssets.diamonds || 0}}</view>
        </view>
      </view>
      <view class="asset-item">
        <view class="asset-icon">🎁</view>
        <view class="asset-info">
          <view class="asset-name">道具</view>
          <view class="asset-value">{{userAssets.items || 0}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 游戏记录 -->
  <view class="game-records-card">
    <view class="card-header">
      <view class="card-title">最近游戏</view>
      <button class="btn btn-ghost btn-sm" bindtap="onGameRecordTap">
        <text class="btn-text">查看全部</text>
      </button>
    </view>
    <view class="records-list" wx:if="{{gameRecords.length > 0}}">
      <view class="record-item" wx:for="{{gameRecords}}" wx:key="id">
        <view class="record-game">
          <image class="record-icon" src="{{item.gameIcon || '/assets/images/game-default.png'}}" mode="aspectFill"></image>
          <view class="record-info">
            <view class="record-name">{{item.gameName}}</view>
            <view class="record-time">{{item.playTime}}</view>
          </view>
        </view>
        <view class="record-result" data-result="{{item.result}}">
          {{item.result === 'win' ? '胜利' : item.result === 'lose' ? '失败' : '平局'}}
        </view>
      </view>
    </view>
    <view class="empty-records" wx:else>
      <view class="empty-text">暂无游戏记录</view>
      <view class="empty-desc">开始你的第一场游戏吧</view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-group">
      <view class="menu-item" bindtap="onSettingsTap">
        <view class="menu-icon">⚙️</view>
        <view class="menu-content">
          <view class="menu-title">设置</view>
          <view class="menu-desc">个性化设置</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="onFeedbackTap">
        <view class="menu-icon">💬</view>
        <view class="menu-content">
          <view class="menu-title">意见反馈</view>
          <view class="menu-desc">帮助我们改进</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
      
      <view class="menu-item" bindtap="onAboutTap">
        <view class="menu-icon">ℹ️</view>
        <view class="menu-content">
          <view class="menu-title">关于我们</view>
          <view class="menu-desc">版本信息</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
    </view>

    <view class="menu-group">
      <view class="menu-item" bindtap="onLogoutTap">
        <view class="menu-icon">🚪</view>
        <view class="menu-content">
          <view class="menu-title">退出登录</view>
          <view class="menu-desc">安全退出</view>
        </view>
        <view class="menu-arrow">></view>
      </view>
    </view>
  </view>

  <!-- 设置弹窗 -->
  <view class="modal-overlay" wx:if="{{showSettings}}" bindtap="hideSettings">
    <view class="modal-content settings-modal" catchtap="true">
      <view class="modal-header">
        <view class="modal-title">设置</view>
        <button class="modal-close" bindtap="hideSettings">×</button>
      </view>
      <view class="modal-body">
        <view class="setting-item">
          <view class="setting-label">音效</view>
          <switch class="setting-switch" checked="{{settings.sound}}" bindchange="onSoundChange"></switch>
        </view>
        <view class="setting-item">
          <view class="setting-label">音乐</view>
          <switch class="setting-switch" checked="{{settings.music}}" bindchange="onMusicChange"></switch>
        </view>
        <view class="setting-item">
          <view class="setting-label">震动</view>
          <switch class="setting-switch" checked="{{settings.vibration}}" bindchange="onVibrationChange"></switch>
        </view>
        <view class="setting-item">
          <view class="setting-label">通知</view>
          <switch class="setting-switch" checked="{{settings.notification}}" bindchange="onNotificationChange"></switch>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- 加载状态 -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading"></view>
    <view class="loading-text">加载中...</view>
  </view>
</view>